#!/usr/bin/perl -w

use strict;
use Data::Dumper;

use TweetConfig;
use TweetImage;
use TweetSearch;
use PrintDriver;

binmode STDOUT, ':utf8'; # prevents warning about wide characters
                         # your terminal must be utf8 ready

for (;;) {
    my @tweets = TweetSearch::search;
    foreach my $tweet ( @tweets ) {
        print("tweet from " . $tweet->{user}->{name} . "\n");
        my $image = TweetImage::create($tweet);
        PrintDriver::print($image);

        # debug
        if ( $TweetConfig::debug > 0 ) {
            mkdir("tweets") if ( not -e "tweets" );
            my $file_prefix = "tweets/" . $tweet->{id};
            $image->Write("$file_prefix.png");
            open(TWEET, ">", "$file_prefix.dat");
            print(TWEET Dumper($tweet));
            close(TWEET);
        }
    }
    sleep 10;
}
